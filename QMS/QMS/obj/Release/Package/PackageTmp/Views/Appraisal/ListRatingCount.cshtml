@using HRMS.Utilities;
@{

    ViewBag.Title = "List";
    Layout = "~/Views/Shared/Layout.cshtml";
    var subModules = Session["subModules"] != null ? (List<HRMS.Data.SubModule>)Session["subModules"] : new List<HRMS.Data.SubModule>();
    var Managers = (List<HRMS.Data.Employee>)(ViewBag.Managers);
    var Sites = (List<HRMS.Data.Site>)(ViewBag.Sites);
    int subModuleId = subModules.Where(m => m.Name == "HR View").FirstOrDefault().Id;
    bool canAdd = HRMS.Utilities.PermissionChecker.HasPermission(subModuleId, 2);
    bool canEdit = HRMS.Utilities.PermissionChecker.HasPermission(subModuleId, 3);
    bool canDelete = HRMS.Utilities.PermissionChecker.HasPermission(subModuleId, 4);
}
<head>
    <meta name="viewport" content="width=device-width" />
    <script src="~/Scripts/Chart.min.js"></script>
    <link href="~/jquery-ui-1.12.1/jquery-ui-1.12.1/jquery-ui.min.css" rel="stylesheet" />
    <link href="~/jquery-ui-1.12.1/jquery-ui-1.12.1/jquery-ui.structure.css" rel="stylesheet" />
    <link href="~/jquery-ui-1.12.1/jquery-ui-1.12.1/jquery-ui.theme.css" rel="stylesheet" />
    <title>Test</title>

    <style>
        .ui-datepicker {
            background: #5c7682;
            border: 1px solid blue;
            color: black
        }

        #StatusChart_container {
            width: 650px;
            height: 350px;
            border: 1px solid #ddd;
        }

        #RatingChart_container {
            width: 650px;
            height: 350px;
            border: 1px solid #ddd;
        }
    </style>
</head>
<main id="mainArea" class="bg-white-500 flex-1 p-3 overflow-hidden">
    <div class="flex flex-col">
        <!--Grid Form-->
        <div class="flex flex-1  flex-col md:flex-row lg:flex-row mx-2">
            <div class="mb-2 border-solid border-gray-300 rounded border shadow-sm w-full">
                <div class="bg-gray-200 px-2 py-3 border-solid border-gray-200 border-b">
                    <span>Objectives Performance Rating</span>
                    @if (canAdd)
                    {
                        <span style="float:right;">
                            @*<button class="bg-green-500 hover:bg-green-800 text-white font-bold py-2 px-4 rounded" onclick="AddJobTitle();">
                                    Add Job Title
                                </button>*@
                            @*<a class="bg-green-500 hover:bg-green-800 text-white font-bold py-2 px-4 rounded" href="@Url.Content("~/Appraisal/Add")">
                                    Add Appraisal
                                </a>*@
                            @*<a class="bg-green-500 hover:bg-green-800 text-white font-bold py-2 px-4 rounded" href="@Url.Content("~/Appraisal/ReportCall")">
                                    ReportCall
                                </a>*@
                        </span>
                    }
                </div>


                @*<div class="row searchSection">
                        <div class="col-md-6">
                            @using (Html.BeginForm("ListAll", "Appraisal", FormMethod.Post))
                            {

                                <label class="  px-1 py-1 ml-3">Search By Code/Name</label>

                                <input type="text" name="search" placeholder="Search by Code or Name" class="border-1 border-gray-400 px-1 py-1 m-2 w-60" />

                                <button class="btn btn-sm btn-primary mb-2 ml-1 " type="submit">
                                    <i class="fa fa-search"></i>

                                    <span class="text-xs">Search</span>
                                </button>



                            }
                        </div>
                        <div class="col-md-3 ">


                            <button class="btn btn-sm  btn-success  ml-10 mt-2 mr-10" type="button" id="FilterSearchToggler">
                                <i class="fa fa-search"></i>

                                <span class="text-sm">Search By Filters</span>
                            </button>
                        </div>

                        <div class="col-md-3 ">


                            @using (Html.BeginForm("ListAll", "Appraisal", FormMethod.Post))
                            {



                                <input type="hidden" name="search" placeholder="Search by Code or Name" class="border-1 border-gray-400 px-1 py-1 m-2 w-60" />

                                <button class="btn btn-sm btn-secondary mt-2 ml-1 " type="submit">


                                    <span class="text-xs">Show All</span>
                                </button>



                            }
                        </div>

                    </div>*@


                @using (Html.BeginForm("ListRatingCount", "Appraisal", FormMethod.Post))
                {
                    <div id="filtersDiv" class="row border-1  p-2 m-3">




                        <div class="col-md-2 ">
                            <div class=" ">

                                <div class="relative">
                                    <select class="appearance-none block w-full bg-gray-200 text-grey-darker border border-gray-200 rounded py-1 px-1 leading-tight focus:outline-none focus:bg-white-500 focus:border-gray-600"
                                            id="Quarter" name="Quarter">
                                        @*<option value="">Select Quarter</option>*@
                                        <option value="0">Select Quarter</option>
                                        <option value="1">Quarter 1</option>
                                        <option value="2">Quarter 2</option>
                                        <option value="3">Quarter 3</option>
                                        <option value="4">Quarter 4</option>

                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-grey-darker">
                                        <svg class="fill-current h-4 w-4" xmlns="#"
                                             viewBox="0 0 20 20">
                                            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                                        </svg>
                                    </div>
                                </div>


                            </div>
                        </div>

                        <div class="col-md-1 ">
                            <div class=" ">

                                <div class="relative">
                                    <select class="appearance-none block w-full bg-gray-200 text-grey-darker border border-gray-200 rounded py-1 px-1 leading-tight focus:outline-none focus:bg-white-500 focus:border-gray-600"
                                            id="AppraisalYear" name="AppraisalYear">
                                        <option value="">Year</option>
                                        <option value="2022" @(DateTime.Now.Year == 2022 ? "selected" : "")>2022</option>
                                        <option value="2023" @(DateTime.Now.Year == 2023 ? "selected" : "")>2023</option>


                                    </select>
                                    @*<div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-grey-darker">
                                            <svg class="fill-current h-4 w-4" xmlns="#"
                                                 viewBox="0 0 20 20">
                                                <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                                            </svg>
                                        </div>*@
                                </div>


                            </div>
                        </div>

                        <div class="col-md-2 ">
                            <div class="">

                                <div class="relative">
                                    <select class="appearance-none block w-full bg-gray-200 text-grey-darker border border-gray-200 rounded py-1 px-1 leading-tight focus:outline-none focus:bg-white-500 focus:border-gray-600"
                                            id="Location" name="Location">
                                        <option value="">Location</option>
                                        <option value="1">Bahrain</option>
                                        <option value="2">Pakistan</option>
                                        <option value="3">USA</option>


                                        @*@foreach (var site in Sites)
                                            {
                                                <option value="@site.Country_Id">@(site.Country.Name)</option>

                                            }*@
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-grey-darker">
                                        <svg class="fill-current h-4 w-4" xmlns="#"
                                             viewBox="0 0 20 20">
                                            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="col-md-2 ">
                            <div class="">

                                <div class="relative">
                                    <select class="appearance-none block w-full bg-gray-200 text-grey-darker border border-gray-200 rounded py-1 px-1 leading-tight focus:outline-none focus:bg-white-500 focus:border-gray-600"
                                            id="Site_Id" name="Site_Id">
                                        <option value="">Facility</option>
                                        @*<option value="1" selected>Bahrain</option>*@
                                        @foreach (var site in Sites)
                                        {
                                            <option value="@site.Id">@(site.Description)</option>

                                        }
                                    </select>
                                    <div class="pointer-events-none absolute inset-y-0 right-0 flex items-center px-2 text-grey-darker">
                                        <svg class="fill-current h-4 w-4" xmlns="#"
                                             viewBox="0 0 20 20">
                                            <path d="M9.293 12.95l.707.707L15.657 8l-1.414-1.414L10 10.828 5.757 6.586 4.343 8z" />
                                        </svg>
                                    </div>
                                </div>
                            </div>
                        </div>




                        <div class="col-md-3 ">
                            <div class="   ">


                                <input type="text" name="searchBySupervisor" placeholder="Supervisor Name" class="border-1 border-gray-400 px-1 bg-gray-200 pb-1 " style="width:130px;" />

                            </div>




                        </div>

                        <div class="col-md-2 ">

                            <button class="btn btn-sm btn-success  float-right " type="submit">
                               

                                <i class="fa fa-print" aria-hidden="true"></i>
                            </button>




                        </div>


                    </div>
                }

                @*<div id="radioButtons" class="form-check">
                        <input id="StatusRadio" type="radio" name="StatusAndRating" value="StatusPreview" onchange="ShuffleBwStatusRating()" checked />
                        <label for="StatusRadio" class=" mr-5 bg-gray-300 px-1">Objectives Status Overview</label>
                        <input id="RatingRadio" type="radio" name="StatusAndRating" value="RatingPreview" onchange="ShuffleBwStatusRating()" />
                        <label class="form-check-label bg-gray-300 px-1" for="RatingRadio">Performance Rating Overview</label>
                    </div>*@
                <br />

                @if (ViewBag.Quarter == 0)
                {
                    @*<p class="border px-1 py-2 text-red-400 text-center"></p>*@
                }
                else
                {

                    <div id="displayBody">
                        @*<div class="text-center"><span class="bg-blue-600 text-white p-2">Total Count for Quarter @ViewBag.Quarter = @ViewBag.TotalCount</span></div>*@
                        <br />
                        @*<div id="StatusDiv">
                                <div class="pl-3"><span class="bg-blue-600 text-white px-1">Objectives Status Overview</span></div>

                                <div class="pl-1">
                                    <table class="table-responsive w-8/12 rounded pl-2">
                                        <thead class="bg-gray-500 text-white text-xs">
                                            <tr>
                                                <th class="border w-1/12 px-1 py-2 text-center">Status</th>
                                                <th class="border w-1/12 px-1 py-2 text-center">Raw Count</th>
                                                <th class="border w-1/12 px-1 py-2 text-center">Percentage</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            <tr>
                                                <td class="border px-1 py-2 text-xs ">Not Initiated</td>
                                                <td class="border px-1 py-2 text-xs text-center">@ViewBag.NotInitiatedTotal</td>
                                                <td class="border px-1 py-2 text-xs text-center">@(ViewBag.NotInitiated.ToString("0.00") + "%")</td>
                                            </tr>
                                            <tr>
                                                <td class="border px-1 py-2 text-xs ">In Progress</td>
                                                <td class="border px-1 py-2 text-xs text-center">@ViewBag.InprogressTotal</td>
                                                <td class="border px-1 py-2 text-xs text-center">@(ViewBag.InProgress.ToString("0.00") + "%")</td>
                                            </tr>
                                            <tr>
                                                <td class="border px-1 py-2 text-xs ">Objectives Agreed</td>
                                                <td class="border px-1 py-2 text-xs text-center">@ViewBag.ObjectivesAgreedTotal</td>
                                                <td class="border px-1 py-2 text-xs text-center">@(ViewBag.ObjectivesAgreed.ToString("0.00") + "%")</td>
                                            </tr>
                                            <tr>
                                                <td class="border px-1 py-2 text-xs ">Evaluation Complete</td>
                                                <td class="border px-1 py-2 text-xs text-center">@ViewBag.EvaluationCompleteTotal</td>
                                                <td class="border px-1 py-2 text-xs text-center">@(ViewBag.EvaluationComplete.ToString("0.00") + "%")</td>
                                            </tr>
                                            <tr>
                                                <td class="border px-1 py-2 text-xs ">Total Count</td>
                                                <td class="border px-1 py-2 text-xs text-center">@ViewBag.TotalCount</td>
                                                <td class="border px-1 py-2 text-xs text-center">-</td>
                                            </tr>
                                        </tbody>
                                    </table>
                                </div>

                                <div id="StatusChart_container" class="m-3">
                                    <div class="text-2xl text-center">Objectives Status Quarter @TempData["Quarter"]</div>
                                    <canvas id="Status_chart"></canvas>
                                </div>
                            </div>*@



                        <div id="RatingDiv" class="">

                            <div class="pl-3">
                                <span class="bg-blue-600 text-white px-1">Performance Rating Overview for Quarter @(ViewBag.Quarter)</span>
                                @*<a class="btn-sm btn-success  no-underline mr-32 "  href="@Url.Content("~/Appraisal/Dashboard2/" )">

                                        Rating Preview


                                    </a>*@
                            </div>
                            <div class="pl-1">
                                <table class="table-responsive w-8/12 rounded pl-2">
                                    <thead class="bg-gray-500 text-white text-xs">
                                        <tr>
                                            <th class="border w-1/12 px-1 py-2 text-center">Performance Rating</th>
                                            <th class="border w-1/12 px-1 py-2 text-center">Raw Count</th>
                                            <th class="border w-1/12 px-1 py-2 text-center">Percentage</th>
                                        </tr>
                                    </thead>

                                    <tbody>


                                        <tr>
                                            <td class="border px-1 py-2 text-xs ">Exemplary Performance</td>
                                            <td class="border px-1 py-2 text-xs text-center">@ViewBag.ExemplaryPerformanceTotal</td>
                                            <td class="border px-1 py-2 text-xs text-center">@(ViewBag.ExemplaryPerformancePercentage.ToString("0.00") + "%")</td>
                                        </tr>
                                        <tr>
                                            <td class="border px-1 py-2 text-xs ">Strong Performance</td>
                                            <td class="border px-1 py-2 text-xs text-center">@ViewBag.StrongPerformanceTotal</td>
                                            <td class="border px-1 py-2 text-xs text-center">@(ViewBag.StrongPerformancePercentage.ToString("0.00") + "%")</td>
                                        </tr>
                                        <tr>
                                            <td class="border px-1 py-2 text-xs ">Solid Performance</td>
                                            <td class="border px-1 py-2 text-xs text-center">@ViewBag.SolidPerformanceTotal</td>
                                            <td class="border px-1 py-2 text-xs text-center">@(ViewBag.SolidPerformancePercentage.ToString("0.00") + "%")</td>
                                        </tr>
                                        <tr>
                                            <td class="border px-1 py-2 text-xs ">Stronger Performance Needed</td>
                                            <td class="border px-1 py-2 text-xs text-center">@ViewBag.StrongerPerformanceNeededTotal</td>
                                            <td class="border px-1 py-2 text-xs text-center">@(ViewBag.StrongerPerformanceNeededPercentage.ToString("0.00") + "%")</td>
                                        </tr>
                                        <tr>
                                            <td class="border px-1 py-2 text-xs ">Improvement Required</td>
                                            <td class="border px-1 py-2 text-xs text-center">@ViewBag.ImprovementRequiredTotal</td>
                                            <td class="border px-1 py-2 text-xs text-center">@(ViewBag.ImprovementRequiredPercentage.ToString("0.00") + "%")</td>
                                        </tr>
                                        <tr>
                                            <td class="border px-1 py-2 text-xs ">Not Rated</td>
                                            <td class="border px-1 py-2 text-xs text-center">@ViewBag.NotRatedTotal</td>
                                            <td class="border px-1 py-2 text-xs text-center">@(ViewBag.NotRatedPercentage.ToString("0.00") + "%")</td>
                                        </tr>

                                    </tbody>
                                </table>

                            </div>
                            <div id="RatingChart_container" class="m-3 @(ViewBag.Quarter == 0 ? "hide" : "")">
                                <div class="text-2xl text-center">Performance Rating Quarter @TempData["Quarter"]</div>
                                <canvas id="Rating_chart"></canvas>
                            </div>
                        </div>

                        <div class="col-12 text-left px-4">

                            <input type="button" value="Export To PDF" id="pdfExportButton" class="btn btn-info btn_print float-end m-5 p-3" onclick="generatePDF()" />
                        </div>
                        <br />

                    </div>

                }
                <!--/Grid Form-->
            </div>
        </div>

</main>

<script src="~/Scripts/jquery-3.6.0.js"></script>
<script src="~/jquery-ui-1.12.1/jquery-ui-1.12.1/jquery-ui.min.js"></script>
<script type="text/javascript">
    $(document).ready(function () {

        //StatusPreview();

        RatingPreview();

    });
    //$('#FilterSearchToggler').click(function () {
    //    $('#filtersDiv').toggleClass('hide');
    //})


    $('#Location').change(function () {
        //alert($(this).val());
        var countryId = $(this).val();
        var Url = '@Url.Content("~/Site/ListSitesByCountry/")' + countryId;

        //alert(Url);
        $.ajax({
            url: Url,
            type: 'GET',
            success: function (response) {
                //alert(response);
                $('#Site_Id').html(response);
            },
            error: function () {
                //alert('Error');
            }

        });

    });



    function RatingPreview() {
        var RatingCount =@Html.Raw(Json.Encode(ViewBag.RatingCount));

        var RatingLabel =@Html.Raw(Json.Encode(ViewBag.RatingLabel));




        var ctx = $("#Rating_chart");
        var bacchart = new Chart(ctx, {

            type:'bar',
            data: {
                labels: RatingLabel,
                datasets: [{
                    label: "Count",
                    data: RatingCount,
                    //backgroundColor: ["rgba(242,166,54,.5)", "rgba(145,65,72,.5)", "rgba(74,25,92,.5)"]
                    backgroundColor: ["#4472C4", "#ed7d31", "#a5a5a5", "#ffc000", "#5b9bd5", "#326BAD", "#296750"]

                }]
            },

            options: {
                maintainAspectRatio: false,
                scales: { xAxes: [{ ticks: { beginAtZero: true } }] },
                legend: {display:true}

            }


        });
    }

    @*function StatusPreview() {
                 var StatusCount =@Html.Raw(Json.Encode(ViewBag.StatusCount));

        var StatusLabel =@Html.Raw(Json.Encode(ViewBag.StatusLabel));




        var ctx = $("#Status_chart");
        var bacchart = new Chart(ctx, {

            type:'bar',
            data: {
                labels: StatusLabel,
                datasets: [{
                    label: "Count",
                    data: StatusCount,
                    //backgroundColor: ["rgba(242,166,54,.5)", "rgba(145,65,72,.5)", "rgba(74,25,92,.5)"]
                    backgroundColor: ["#4472C4", "#ed7d31", "#a5a5a5", "#ffc000", "#5b9bd5"]

                }]
            },

            options: {
                maintainAspectRatio: false,
                scales: { xAxes: [{ ticks: { beginAtZero: true } }] },
                legend: {display:false}

            }


        });
    }*@

    //function ShuffleBwStatusRating() {

    //    $('#StatusDiv').toggleClass('hide');
    //    $('#RatingDiv').toggleClass('hide');
    //}

    function generatePDF() {
        //const element = document.getElementById("container_content");
        //html2pdf()
        //    .from(element)
        //    .save();

        //const element0 = document.getElementById("filtersDiv");
        //const element1 = document.getElementById("radioButtons");
        //const element2 = document.getElementById("LayoutHeader");
        //const element3 = document.getElementById("LayoutFooter");
        //const element4 = document.getElementById("pdfExportButton");

        //element0.style.display = 'none';
        //element1.style.display = 'none';
        //element2.style.display = 'none';
        //element3.style.display = 'none';
        //element4.style.display = 'none';

        $('#filtersDiv').addClass('hide');
        $('#radioButtons').addClass('hide');
        $('#LayoutHeader').addClass('hide');
        $('#LayoutFooter').addClass('hide');
        $('#pdfExportButton').addClass('hide');
        //$('#changeCol').removeClass('col-8').addClass('col-12');
        //$('#container').removeClass('border')

        window.print();
        $('#filtersDiv').removeClass('hide');
        $('#radioButtons').removeClass('hide');
        $('#LayoutHeader').removeClass('hide');
        $('#LayoutFooter').removeClass('hide');
        $('#pdfExportButton').removeClass('hide');

        //element0.style.display = 'block';
        //element1.style.display = 'block';
        //element2.style.display = 'block';
        //element3.style.display = 'block';
        //element4.style.display = 'block';

        //$('#container').addClass('border')
        //$('#changeCol').addClass('col-8').removeClass('col-12');
    }
</script>
